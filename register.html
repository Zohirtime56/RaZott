<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #1a1a1a; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .box { padding: 20px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; }
        .red { background-color: #ff4444; color: white; }
        .green { background-color: #00C851; color: white; }
        input { padding: 10px; width: 80%; margin: 5px 0; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: #ffd700; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px;}
    </style>
</head>
<body>

    <div id="status-box" class="box red">
        Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…... â³
    </div>

    <h3>ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
    <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <br>
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <br>
    <button id="regBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ø¶ØºØ· Ù‡Ù†Ø§)</button>

    <div id="log" style="margin-top: 20px; color: yellow; text-align: left; direction: ltr; border: 1px solid #555; padding: 10px;">
        Console Logs will appear here...
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
        function log(text) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += `<div>>> ${text}</div>`;
            console.log(text);
        }

        // 1. ÙØ­Øµ Ù‡Ù„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©ØŸ
        window.onload = function() {
            log("Page Loaded. Checking Supabase library...");
            
            if (window.supabase) {
                document.getElementById('status-box').className = "box green";
                document.getElementById('status-box').innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„: Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù…Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­";
                log("Library found. Initializing...");
                initApp();
            } else {
                document.getElementById('status-box').innerText = "âŒ Ø®Ø·Ø£: Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù„Ù… ØªØªØ­Ù…Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.";
                log("Error: window.supabase is undefined");
            }
        };

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function initApp() {
            const SUPABASE_URL = 'https://oezehdkfucwhttsrocsv.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9lemVoZGtmdWN3aHR0c3JvY3N2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5Mzg4OTMsImV4cCI6MjA4MjUxNDg5M30.WB567kJLDTTWJMpkw8QLq3Y1DL0serVz6-v95TJubKo';

            try {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                log("Supabase Client Created.");

                // Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨Ø§Ù„Ø¯Ø§Ù„Ø©
                document.getElementById('regBtn').onclick = async function() {
                    log("Button Clicked. Starting registration...");
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;

                    if(!email || !password) {
                        alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯!");
                        log("Empty fields.");
                        return;
                    }

                    log(`Attempting signup for: ${email}`);

                    const { data, error } = await supabase.auth.signUp({
                        email: email,
                        password: password
                    });

                    if (error) {
                        log("Signup Error: " + error.message);
                        alert("Ø®Ø·Ø£: " + error.message);
                    } else {
                        log("Signup Success! User ID: " + (data.user ? data.user.id : 'unknown'));
                        alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰");
                        
                        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
                        if(data.user) {
                             const { error: dbError } = await supabase.from('profiles').insert([
                                { id: data.user.id, username: email.split('@')[0] }
                            ]);
                            if(dbError) log("DB Error: " + dbError.message);
                            else log("Profile saved to DB.");
                        }
                    }
                };
            } catch (err) {
                log("CRASH: " + err.message);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¨Ø±Ù…Ø¬ÙŠ: " + err.message);
            }
        }
    </script>
</body>
</html>
