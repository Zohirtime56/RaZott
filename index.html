<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù†Ø¬Ù… Ø§Ù„Ø°Ù‡Ø¨ | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #1a1a1a; color: white; text-align: center; padding-top: 50px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { background: #2d2d2d; border: 1px solid #ffd700; max-width: 400px; margin: auto; padding: 30px; border-radius: 15px; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }
        .btn-gold { background: #ffd700; color: black; font-weight: bold; width: 100%; padding: 10px; border: none; }
        .btn-gold:hover { background: #ffea00; }
        .stat-box { font-size: 18px; color: #00ff00; margin: 20px 0; background: #000; padding: 15px; border-radius: 10px; border: 1px solid #333; }
        a { text-decoration: none; color: #ffd700; }
    </style>
</head>
<body>

    <div id="login-screen" class="container">
        <h2 class="mb-4" style="color: #ffd700;">ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ù†Ø¬Ù…</h2>
        
        <div class="card">
            <div class="mb-3">
                <input type="email" id="email" class="form-control" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" style="background: #444; color: white; border: none;">
            </div>
            <div class="mb-3">
                <input type="password" id="password" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="background: #444; color: white; border: none;">
            </div>
            
            <button onclick="login()" class="btn btn-gold mb-3">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù† ğŸš€</button>
            
            <a href="register.html">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹</a>
            
            <p id="msg" class="mt-3 text-danger"></p>
        </div>
    </div>

    <div id="game-screen" class="container d-none">
        <h3 class="text-warning">â›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
        <p class="text-secondary">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <span id="user-email" class="text-white"></span></p>
        
        <div class="stat-box">
            <div>ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            <h2 id="balance">0.0000</h2>
            <hr style="border-color: #555;">
            <small>âš¡ Ù‚ÙˆØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ†: 0.0001 / Ø«</small>
        </div>

        <div style="margin: 30px auto;">
            <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3ZxeWwzb3ZxeWwzb3ZxeWwzb3ZxeWwzb3ZxeWwzb3ZxeWwzb3ZxeWwzbSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/LdOyjZ7FKs0RlAzU8a/giphy.gif" width="120" style="border-radius: 50%; border: 3px solid #ffd700;">
        </div>
        
        <h3 id="pending" style="color: #ffd700; font-family: monospace;">0.00000</h3>
        <p class="text-secondary">Ø£Ø±Ø¨Ø§Ø­ Ø¬Ø§Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ†Ù‡Ø§...</p>

        <button onclick="collect()" class="btn btn-success w-100 py-3 fw-bold">Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„Ù„Ù…Ø­ÙØ¸Ø© ğŸ“¥</button>
        <button onclick="logout()" class="btn btn-outline-danger w-100 mt-3">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <script>
        // Ù…ÙØ§ØªÙŠØ­Ùƒ Ø§Ù„ØµØ­ÙŠØ­Ø©
        const SUPABASE_URL = 'https://oezehdkfucwhttsrocsv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9lemVoZGtmdWN3aHR0c3JvY3N2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5Mzg4OTMsImV4cCI6MjA4MjUxNDg5M30.WB567kJLDTTWJMpkw8QLq3Y1DL0serVz6-v95TJubKo';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let currentUser = null;

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const msg = document.getElementById('msg');

            if(!email || !password) { msg.innerText = "Ø§ÙƒØªØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!"; return; }
            msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";

            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                msg.innerText = "âŒ Ø®Ø·Ø£: " + error.message;
            } else {
                currentUser = data.user;
                // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                fetchProfile();
            }
        }

        async function fetchProfile() {
            const { data } = await supabase.from('profiles').select('*').eq('id', currentUser.id).single();
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (Ø­Ø§Ù„Ø© Ù†Ø§Ø¯Ø±Ø©)ØŒ ÙŠÙ†Ø´Ø¦Ù‡ ÙÙˆØ±Ø§Ù‹
            if (!data) {
                await supabase.from('profiles').insert([{ id: currentUser.id, username: currentUser.email }]);
                document.getElementById('balance').innerText = "0.0000";
            } else {
                document.getElementById('balance').innerText = data.balance.toFixed(4);
            }
            
            showGame();
        }

        function showGame() {
            document.getElementById('login-screen').classList.add('d-none');
            document.getElementById('game-screen').classList.remove('d-none');
            document.getElementById('user-email').innerText = currentUser.email;
            
            // Ø¹Ø¯Ø§Ø¯ ÙˆÙ‡Ù…ÙŠ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…ØªØ¹Ø©
            setInterval(() => {
                let current = parseFloat(document.getElementById('pending').innerText);
                document.getElementById('pending').innerText = (current + 0.00001).toFixed(5);
            }, 100);
        }

        async function logout() {
            await supabase.auth.signOut();
            location.reload();
        }

        async function collect() {
            alert("Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø§Ù„Ø³Ø­Ø¨ Ù‚Ø±ÙŠØ¨Ø§Ù‹!");
        }
    </script>
</body>
</html>
