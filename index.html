<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù†Ø¬Ù… Ø§Ù„Ø°Ù‡Ø¨ | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #1a1a1a; color: white; text-align: center; padding-top: 50px; }
        .card { background: #333; color: white; border: 1px solid #ffd700; max-width: 400px; margin: auto; padding: 20px; }
        .btn-gold { background: #ffd700; color: black; font-weight: bold; width: 100%; }
        .stat-box { font-size: 20px; color: #00ff00; margin: 20px; border: 1px dashed #555; padding: 10px;}
    </style>
</head>
<body>

    <div id="login-screen" class="container">
        <h2 class="text-warning">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div class="card mt-4">
            <input type="email" id="email" class="form-control mb-2" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" value="zouhirtissoudali@gmail.com">
            <input type="password" id="password" class="form-control mb-2" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button onclick="login()" class="btn btn-gold">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†Ø¬Ù…</button>
            <p id="msg" class="mt-2 text-danger"></p>
        </div>
    </div>

    <div id="game-screen" class="container d-none">
        <h2 class="text-warning">â›ï¸ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ†</h2>
        <p>Ù…Ø±Ø­Ø¨Ø§Ù‹: <span id="user-email" class="text-info"></span></p>
        
        <div class="stat-box">
            Ø§Ù„Ø±ØµÙŠØ¯: <span id="balance">0.0000</span> $<br>
            <small>Ù‚ÙˆØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ†: 0.0001 / Ø«</small>
        </div>

        <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3ZxeWwzb3ZxeWwzb3ZxeWwzb3ZxeWwzb3ZxeWwzb3ZxeWwzb3ZxeWwzbSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/LdOyjZ7FKs0RlAzU8a/giphy.gif" width="100">
        
        <h3 id="pending" class="mt-3 text-warning">0.0000</h3>
        <button onclick="collect()" class="btn btn-success w-100">Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ğŸ’°</button>
        <button onclick="logout()" class="btn btn-outline-light w-100 mt-3">Ø®Ø±ÙˆØ¬</button>
    </div>

    <script>
        // Ù…ÙØ§ØªÙŠØ­Ùƒ Ø§Ù„ØµØ­ÙŠØ­Ø©
        const SUPABASE_URL = 'https://oezehdkfucwhttsrocsv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9lemVoZGtmdWN3aHR0c3JvY3N2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5Mzg4OTMsImV4cCI6MjA4MjUxNDg5M30.WB567kJLDTTWJMpkw8QLq3Y1DL0serVz6-v95TJubKo';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let currentUser = null;

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const msg = document.getElementById('msg');

            msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";

            // 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                msg.innerText = "Ø®Ø·Ø£: " + error.message;
            } else {
                currentUser = data.user;
                msg.innerText = "âœ… ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„! Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
                
                // 2. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (Ù„Ø£Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¦Ù‡)
                await ensureProfileExists();
                showGame();
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥ØµÙ„Ø§Ø­ Ø®Ø·Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        async function ensureProfileExists() {
            const { data } = await supabase.from('profiles').select('*').eq('id', currentUser.id).single();
            if (!data) {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙŠÙ†Ø´Ø¦Ù‡Ø§ Ø§Ù„Ø¢Ù†
                await supabase.from('profiles').insert([{ id: currentUser.id, username: currentUser.email }]);
            }
        }

        async function showGame() {
            document.getElementById('login-screen').classList.add('d-none');
            document.getElementById('game-screen').classList.remove('d-none');
            document.getElementById('user-email').innerText = currentUser.email;
            
            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯
            setInterval(() => {
                let current = parseFloat(document.getElementById('pending').innerText);
                document.getElementById('pending').innerText = (current + 0.00001).toFixed(5);
            }, 100);
        }

        async function logout() {
            await supabase.auth.signOut();
            location.reload();
        }

        async function collect() {
            alert("Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¯Ù…!");
        }
    </script>
</body>
    </html>
